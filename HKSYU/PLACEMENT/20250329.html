<!DOCTYPE html>

<！DOCTYPE html><html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>左鄰有「你」- 心之迷途</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
        }
        

<html lang=“zh-HK”>
<頭>
<meta charset=“UTF-8”>
<meta name=“viewport” content=“width=device-width， initial-scale=1.0”>
<title>左鄰有「你」- 心之迷途</title>
<style>
        * {
邊距： 0;
填充： 0;
框大小： border-box;
字體系列： 'Microsoft JhengHei'， Arial， sans-serif;
        }

    body {
        background-color: #121212;
        color: #e0e0e0;
        line-height: 1.6;
        overflow-x: hidden;
        background-image: radial-gradient(circle at center, #1a1a2e 0%, #121212 70%);
    }
    
    .game-container {
        display: none;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        position: relative;
    }
    
    .game-title {
        text-align: center;
        font-size: 2.5rem;
        margin-bottom: 10px;
        letter-spacing: 2px;
        color: rgba(255, 255, 255, 0.9);
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }
    
    .glow {
        animation: glow 2s ease-in-out infinite alternate;
    }
    
    @keyframes glow {
        from {
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #4a148c, 0 0 20px #4a148c;
        }
        to {
            text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #4a148c, 0 0 40px #4a148c;
        }
    }
    
    .game-subtitle {
        text-align: center;
        font-size: 1.2rem;
        margin-bottom: 30px;
        opacity: 0.8;
    }
    
    .stage {
        display: none;
        animation: fadeIn 1s ease;
    }
    
    .stage.active {
        display: block;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .stage-title {
        font-size: 1.5rem;
        margin-bottom: 15px;
        color: #9c27b0;
        border-bottom: 1px solid rgba(156, 39, 176, 0.3);
        padding-bottom: 10px;
    }
    
    .stage-description {
        margin-bottom: 20px;
        font-size: 1.1rem;
        line-height: 1.6;
    }
    
    .story-section {
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        padding: 15px;
        margin: 15px 0;
        position: relative;
        overflow: hidden;
    }
    
    .story-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(74, 20, 140, 0.1) 0%, rgba(0, 0, 0, 0) 100%);
        pointer-events: none;
    }
    
    .story-section.objective {
        background-color: rgba(33, 150, 243, 0.1);
        border-left: 3px solid #2196F3;
    }
    
    .story-section.note {
        background-color: rgba(255, 152, 0, 0.1);
        border-left: 3px solid #FF9800;
        font-style: italic;
    }
    
    .input-section {
        margin: 20px 0;
        text-align: center;
    }
    
    input[type="text"], input[type="password"] {
        width: 100%;
        padding: 12px;
        border: none;
        background-color: rgba(255, 255, 255, 0.1);
        color: #fff;
        border-radius: 5px;
        margin-bottom: 10px;
        font-size: 1rem;
    }
    
    input[type="text"]::placeholder, input[type="password"]::placeholder {
        color: rgba(255, 255, 255, 0.5);
    }
    
    button {
        padding: 10px 20px;
        background-color: #4a148c;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    button:hover {
        background-color: #6a1b9a;
        transform: translateY(-2px);
    }
    
    .error-message {
        color: #f44336;
        font-size: 0.9rem;
        margin-top: 5px;
        min-height: 1.5em;
    }
    
    .hint {
        font-size: 0.9rem;
        color: #aaa;
        margin-bottom: 10px;
        font-style: italic;
    }
    
    .progress-bar {
        width: 100%;
        height: 10px;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 5px;
        overflow: hidden;
        margin-bottom: 20px;
    }
    
    .progress {
        height: 100%;
        background: linear-gradient(90deg, #4a148c 0%, #9c27b0 100%);
        width: 0%;
        transition: width 1s ease;
        box-shadow: 0 0 10px rgba(156, 39, 176, 0.7);
    }
    
    .location-guide {
        background-color: rgba(33, 150, 243, 0.15);
        border: 1px solid rgba(33, 150, 243, 0.3);
        border-radius: 10px;
        padding: 15px;
        margin: 20px 0;
        position: relative;
    }
    
    .location-title {
        color: #2196F3;
        font-size: 1.2rem;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
    }
    
    .location-icon {
        margin-right: 10px;
        font-size: 1.4rem;
    }
    
    .location-path {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .location-step {
        background-color: rgba(255, 255, 255, 0.1);
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .location-step:hover {
        background-color: rgba(33, 150, 243, 0.2);
    }
    
    .location-step.active {
        background-color: rgba(33, 150, 243, 0.3);
        font-weight: bold;
    }
    
    .location-arrow {
        color: #aaa;
        font-size: 0.8rem;
    }
    
    .location-clue {
        margin-top: 10px;
        font-style: italic;
        color: #bbb;
        font-size: 0.9rem;
    }
    
    .notebook {
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 5px;
        padding: 15px;
        margin: 30px auto;
        position: relative;
        box-shadow: 0 3px 15px rgba(0, 0, 0, 0.2);
        max-width: 90%;
        height: 250px;
        cursor: pointer;
        perspective: 1000px;
        transition: all 0.5s ease;
        z-index: 10;
    }
    
    .notebook-inner {
        position: relative;
        width: 100%;
        height: 100%;
        transition: transform 0.8s;
        transform-style: preserve-3d;
    }
    
    .notebook.flipped .notebook-inner {
        transform: rotateY(180deg);
    }
    
    .notebook-front, .notebook-back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        border-radius: 5px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    
    .notebook-front {
        background-color: #4a148c;
        align-items: center;
        padding: 20px;
    }
    
    .notebook-back {
        background-color: rgba(255, 255, 255, 0.05);
        transform: rotateY(180deg);
        padding: 15px;
        overflow-y: auto;
    }
    
    .notebook-title {
        color: #aaa;
        margin-bottom: 10px;
        font-size: 1.2rem;
        font-weight: normal;
        border-bottom: 1px dashed rgba(255, 255, 255, 0.2);
        padding-bottom: 5px;
    }
    
    .notebook-entry {
        margin-bottom: 10px;
        font-size: 0.95rem;
        line-height: 1.5;
        color: #ddd;
    }
    
    .notebook-highlight {
        color: #ce93d8;
        font-weight: bold;
    }
    
    .envelope-icon {
        font-size: 3rem;
        color: #fff;
    }
    
    .progress-map-container {
        position: relative;
        width: 100%;
        height: 150px;
        margin: 30px 0;
        overflow: hidden;
    }
    
    .progress-map {
        width: 100%;
        height: 100%;
    }
    
    .progress-path {
        stroke-dasharray: 1000;
        stroke-dashoffset: 1000;
        animation: drawPath 2s forwards ease-out;
    }
    
    @keyframes drawPath {
        to {
            stroke-dashoffset: 0;
        }
    }
    
    .progress-node {
        fill: #444;
        transition: all 0.5s ease;
        cursor: pointer;
    }
    
    .progress-node.current {
        fill: #9c27b0;
        filter: drop-shadow(0 0 5px rgba(156, 39, 176, 0.7));
    }
    
    .progress-node.completed {
        fill: #4caf50;
    }
    
    .progress-node.locked {
        fill: #444;
    }
    
    .progress-label {
        fill: #aaa;
        font-size: 0.7rem;
        text-anchor: middle;
        pointer-events: none;
    }
    
    .map-container {
        position: relative;
        width: 100%;
        height: 200px;
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        margin: 20px 0;
        overflow: hidden;
        background-image: radial-gradient(circle at center, #1a1a2e 0%, #0f0f1a 100%);
    }
    
    .location {
        position: absolute;
        width: 30px;
        height: 30px;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
    }
    
    .location::after {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.1);
        transform: scale(1);
        z-index: -1;
    }
    
    .location:hover {
        background-color: rgba(255, 255, 255, 0.2);
        transform: translate(-50%, -50%) scale(1.1);
    }
    
    .location-label {
        position: absolute;
        bottom: -20px;
        white-space: nowrap;
        font-size: 0.8rem;
        color: #aaa;
        text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
    }
    
    .location.pulse::after {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); opacity: 1; }
        70% { transform: scale(2); opacity: 0; }
        100% { transform: scale(1); opacity: 0; }
    }
    
    .hidden-clue {
        position: absolute;
        visibility: hidden;
        opacity: 0;
    }
    
    .community-map {
        width: 100%;
        height: 250px;
        background-color: #1a1a2e;
        border-radius: 10px;
        margin: 20px 0;
        position: relative;
        overflow: hidden;
    }
    
    .community-building {
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .community-building:hover {
        filter: brightness(1.3);
    }
    
    .community-label {
        fill: white;
        font-size: 0.8rem;
        text-anchor: middle;
        pointer-events: none;
    }
    
    .treasure-box {
        width: 200px;
        height: 150px;
        background-color: #3e2723;
        border-radius: 10px;
        margin: 20px auto;
        position: relative;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        overflow: hidden;
    }
    
    .treasure-box::before {
        content: '';
        position: absolute;
        width: 80%;
        height: 10px;
        background-color: #5d4037;
        top: 40px;
        left: 10%;
        border-radius: 5px;
    }
    
    .treasure-box::after {
        content: '';
        position: absolute;
        width: 40px;
        height: 20px;
        background-color: #fbdc05;
        top: 60px;
        left: calc(50% - 20px);
        border-radius: 5px;
        box-shadow: 0 0 10px #fbdc05;
        transition: all 0.3s ease;
    }
    
    .treasure-box:hover {
        transform: scale(1.05);
    }
    
    .treasure-box.open {
        background-color: #4e342e;
    }
    
    .treasure-box.open::before {
        animation: openLid 1s forwards;
    }
    
    @keyframes openLid {
        0% { transform: rotateX(0deg); }
        100% { transform: rotateX(-90deg); opacity: 0; }
    }
    
    .treasure-box.open::after {
        animation: glowKey 1s infinite alternate;
    }
    
    @keyframes glowKey {
        from { box-shadow: 0 0 10px #fbdc05; }
        to { box-shadow: 0 0 20px #fbdc05, 0 0 40px #fbdc05; }
    }
    
    .treasure-box.shake {
        animation: shake 0.5s ease;
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        20%, 60% { transform: translateX(-10px); }
        40%, 80% { transform: translateX(10px); }
    }
    
    .phone {
        width: 180px;
        height: 300px;
        background-color: #000;
        border-radius: 20px;
        margin: 20px auto;
        position: relative;
        padding: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
    }
    
    .phone-screen {
        width: 100%;
        height: 85%;
        background-color: #121212;
        border-radius: 10px;
        overflow-y: auto;
        padding: 10px;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .phone-button {
        width: 40px;
        height: 40px;
        background-color: #333;
        border-radius: 50%;
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .phone-button:hover {
        background-color: #444;
    }
    
    .message {
        padding: 8px 12px;
        border-radius: 15px;
        max-width: 80%;
        word-break: break-word;
        font-size: 0.9rem;
        animation: messageIn 0.3s ease;
    }
    
    @keyframes messageIn {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    
    .message.incoming {
        background-color: #263238;
        align-self: flex-start;
        border-bottom-left-radius: 5px;
    }
    
    .message.outgoing {
        background-color: #4a148c;
        align-self: flex-end;
        border-bottom-right-radius: 5px;
    }
    
    .inventory {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 20px 0;
        justify-content: center;
    }
    
    .food-item {
        width: 80px;
        padding: 10px;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .food-item:hover {
        transform: translateY(-5px);
        background-color: rgba(255, 255, 255, 0.15);
    }
    
    .food-img {
        font-size: 2rem;
        margin-bottom: 5px;
    }
    
    .effect-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 100;
        overflow: hidden;
    }
    
    .sparkle {
        position: absolute;
        width: 8px;
        height: 8px;
        background-color: #fff;
        border-radius: 50%;
        box-shadow: 0 0 10px #fff, 0 0 20px #fff;
        animation: fadeOut 1s forwards;
    }
    
    @keyframes fadeOut {
        to { opacity: 0; transform: scale(0); }
    }
    
    .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        opacity: 1;
        animation: fall 3s forwards linear;
    }
    
    @keyframes fall {
        to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    
    .achievements {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin: 15px 0;
    }
    
    .achievement {
        width: 80px;
        height: 80px;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        transition: all 0.3s ease;
        font-size: 2rem;
        opacity: 0.3;
    }
    
    .achievement.unlocked {
        background-color: rgba(255, 215, 0, 0.2);
        box-shadow: 0 0 15px gold;
        opacity: 1;
    }
    
    .achievement-label {
        position: absolute;
        bottom: -25px;
        left: 50%;
        transform: translateX(-50%);
        white-space: nowrap;
        font-size: 0.8rem;
        color: #aaa;
    }
    
    .achievement.unlocked .achievement-label {
        color: gold;
    }
    
    .money-collection {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 20px 0;
        justify-content: center;
    }
    
    .money-item {
        width: 80px;
        height: 80px;
        background-color: #fbdc05;
        border-radius: 50%;
        color: #000;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 10px rgba(251, 220, 5, 0.5);
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .money-item:hover {
        transform: translateY(-5px) rotate(10deg);
        box-shadow: 0 0 15px rgba(251, 220, 5, 0.7);
    }
    
    .money-value {
        font-size: 1.5rem;
    }
    
    .eerie-effect {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at center, transparent 0%, rgba(0, 0, 0, 0.5) 100%);
        pointer-events: none;
        z-index: 0;
    }
    
    .void-circle {
        position: absolute;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.1);
        background-color: rgba(0, 0, 0, 0.2);
        transform: translate(-50%, -50%);
        animation: pulse-void 4s infinite alternate;
    }
    
    @keyframes pulse-void {
        0% { box-shadow: 0 0 10px rgba(74, 20, 140, 0.3); }
        100% { box-shadow: 0 0 30px rgba(74, 20, 140, 0.7); }
    }
    
    .void-heart {
        position: relative;
        width: 100px;
        height: 100px;
        margin: 20px auto;
    }
    
    .void-heart::before, .void-heart::after {
        content: '';
        position: absolute;
        width: 50px;
        height: 80px;
        border: 2px solid #4a148c;
        border-radius: 50px 50px 0 0;
        background-color: transparent;
    }
    
    .void-heart::before {
        transform: rotate(-45deg);
        left: 20px;
    }
    
    .void-heart::after {
        transform: rotate(45deg);
        right: 20px;
    }
    
    .void-heart.filling::before, .void-heart.filling::after {
        background-color: rgba(74, 20, 140, 0.3);
        animation: fill-heart 2s forwards;
    }
    
    @keyframes fill-heart {
        0% { background-color: rgba(74, 20, 140, 0); }
        100% { background-color: rgba(74, 20, 140, 0.7); }
    }
    
    .fog {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxkZWZzPjxmaWx0ZXIgaWQ9ImZvZyI+PGZlVHVyYnVsZW5jZSB0eXBlPSJmcmFjdGFsTm9pc2UiIGJhc2VGcmVxdWVuY3k9IjAuMDEiIG51bU9jdGF2ZXM9IjUiIHN0aXRjaFRpbGVzPSJzdGl0Y2giIHJlc3VsdD0ibm9pc2UiIC8+PGZlQ29sb3JNYXRyaXggaW49Im5vaXNlIiB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMSAwIDAgMCAwIDAgMSAwIDAgMCAwIDAgMSAwIDAgMCAwIDAgMC4xIDAiIHJlc3VsdD0iZm9nIiAvPjwvZmlsdGVyPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ0cmFuc3BhcmVudCIgZmlsdGVyPSJ1cmwoI2ZvZykiIC8+PC9zdmc+');
        opacity: 0.3;
        pointer-events: none;
        z-index: 1;
    }
    
    .dialogue-container {
        position: relative;
        padding: 10px 15px;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 8px;
        font-size: 1rem;
        margin: 15px 0;
        text-align: left;
        max-height: 0;
        overflow: hidden;
        opacity: 0;
        transition: all 0.5s ease;
    }
    
    .dialogue-container.show {
        max-height: 300px;
        opacity: 1;
        margin: 15px 0;
    }
    
    .dialogue-text {
        margin: 5px 0;
        color: #fff;
    }
    
    .dialogue-name {
        color: #9c27b0;
        font-weight: bold;
        margin-right: 10px;
    }
    
    .typing-effect {
        overflow: hidden;
        white-space: nowrap;
        border-right: 2px solid #fff;
        animation: typing 3s steps(40, end), blink-caret 0.75s step-end infinite;
    }
    
    @keyframes typing {
        from { width: 0 }
        to { width: 100% }
    }
    
    @keyframes blink-caret {
        from, to { border-color: transparent }
        50% { border-color: #fff }
    }
    
    .cutscene {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.85);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 20px;
        opacity: 0;
        visibility: hidden;
        transition: all 0.5s ease;
    }
    
    .cutscene.active {
        opacity: 1;
        visibility: visible;
    }
    
    .cutscene-content {
        max-width: 800px;
        text-align: center;
    }
    
    .cutscene-title {
        font-size: 2rem;
        margin-bottom: 20px;
        color: #fff;
        text-shadow: 0 0 10px rgba(156, 39, 176, 0.7);
    }
    
    .cutscene-text {
        font-size: 1.2rem;
        line-height: 1.6;
        margin-bottom: 30px;
        color: #eee;
    }
    
    .cutscene-continue {
        font-size: 1rem;
        color: #aaa;
        margin-top: 30px;
        animation: pulse 1s infinite alternate;
    }
    
    .envelope-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        z-index: 1500;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.5s ease;
    }
    
    .envelope-container.active {
        opacity: 1;
        visibility: visible;
    }
    
    .envelope-svg {
        width: 300px;
        height: 200px;
        position: relative;
        perspective: 1000px;
    }
    
    .envelope-body {
        fill: #4a148c;
        stroke: #6a1b9a;
        stroke-width: 2;
        filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.5));
    }
    
    .envelope-flap {
        fill: #6a1b9a;
        transform-origin: center top;
        transition: transform 2s ease;
    }
    
    .envelope-container.opening .envelope-flap {
        transform: rotateX(180deg);
    }
    
    .envelope-letter {
        position: absolute;
        width: 260px;
        height: 160px;
        background: white;
        border-radius: 5px;
        top: 20px;
        left: 20px;
        padding: 15px;
        transform: translateY(0);
        transition: transform 1s ease;
        z-index: -1;
        color: #333;
        font-size: 0.9rem;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    
    .envelope-container.opening .envelope-letter {
        transform: translateY(-100px);
        z-index: 1;
    }
    
    .letter-title {
        font-size: 1.2rem;
        margin-bottom: 10px;
        color: #4a148c;
        font-weight: bold;
    }
    
    .letter-content {
        text-align: center;
        line-height: 1.4;
    }
    
    .envelope-glow {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        background: radial-gradient(circle at center, rgba(156, 39, 176, 0.3) 0%, transparent 70%);
        filter: blur(10px);
        animation: envelope-pulse 2s infinite alternate;
    }
    
    @keyframes envelope-pulse {
        from { opacity: 0.5; }
        to { opacity: 1; }
    }
    
    .key-effect {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        opacity: 0;
        transition: opacity 0.5s ease, transform 1s ease;
    }

    .key-effect.show {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.5);
    }
    
    .start-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #121212;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        background-image: radial-gradient(circle at center, #1a1a2e 0%, #121212 70%);
    }

    .start-screen .game-title {
        font-size: 3rem;
        margin-bottom: 20px;
    }

    .start-screen .game-subtitle {
        font-size: 1.5rem;
        margin-bottom: 30px;
    }

    .start-screen button {
        padding: 15px 30px;
        font-size: 1.2rem;
        background-color: #4a148c;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .start-screen button:hover {
        background-color: #6a1b9a;
        transform: scale(1.1);
    }

    .hint-card {
        position: relative;
        max-height: 0;
        overflow: hidden;
        opacity: 0;
        transition: all 0.5s ease;
    }
    
    .hint-card.show {
        max-height: 300px;
        opacity: 1;
        margin: 15px 0;
    }
    
    .hint-btn {
        background-color: rgba(33, 150, 243, 0.2);
        color: #2196F3;
        border: 1px solid #2196F3;
        margin-top: 5px;
    }
    
    .hint-btn:hover {
        background-color: rgba(33, 150, 243, 0.3);
    }
</style>

</head>
<body>
    <div class="eerie-effect"></div>
    <div class="fog"></div>
    

</頭>
<身體>
<div class=“eerie-effect”></div>
<div class=“fog”></div>

<div class="start-screen">
    <h1 class="game-title glow">左鄰有「你」</h1>
    <p class="game-subtitle">尋找心之鎖匙</p>
    <button id="gameStartBtn">Game Start</button>
</div>

<div class="game-container">
    <h1 class="game-title glow">左鄰有「你」</h1>
    <p class="game-subtitle">尋找心之鎖匙</p>
    
    <div class="progress-bar">
        <div class="progress" id="progressBar"></div>
    </div>
    
    <!-- 信封動畫容器 -->
    <div class="envelope-container" id="envelope-container">
        <div class="envelope-glow"></div>
        <svg class="envelope-svg" viewBox="0 0 300 200">
            <rect class="envelope-body" x="20" y="50" width="260" height="150" rx="5"/>
            <path class="envelope-flap" d="M20,50 L150,120 L280,50 L280,50 L150,20 L20,50 Z"/>
            <path class="envelope-fold" d="M20,50 L150,120 L20,200" fill="none" stroke="#6a1b9a" stroke-width="1" opacity="0.5"/>
            <path class="envelope-fold" d="M280,50 L150,120 L280,200" fill="none" stroke="#6a1b9a" stroke-width="1" opacity="0.5"/>
        </svg>
        <div class="envelope-letter" id="envelope-letter">
            <h3 class="letter-title" id="letter-title">心之迷途</h3>
            <p class="letter-content" id="letter-content">你醒來於一個熟悉又陌生的空間，這裡像是社區的倒影，卻籠罩著詭異的氛圍。更奇怪的是，你感覺不到任何情感，如同心是空洞的。</p>
        </div>
    </div>
    
    <!-- 過場動畫容器 -->
    <div class="cutscene" id="cutscene">
        <div class="cutscene-content">
            <h2 class="cutscene-title" id="cutscene-title"></h2>
            <p class="cutscene-text" id="cutscene-text"></p>
            <p class="cutscene-continue">點擊任意處繼續...</p>
        </div>
    </div>
    
    <!-- 進程地圖 -->
    <div class="progress-map-container">
        <svg class="progress-map" viewBox="0 0 800 100" preserveAspectRatio="xMidYMid meet">
            <path class="progress-path" d="M50,50 C150,20 250,80 350,50 C450,20 550,80 650,50 S750,20 750,50" 
                stroke="#444" stroke-width="10" fill="none" stroke-linecap="round"/>
            <circle class="progress-node current" id="node0" cx="50" cy="50" r="10"/>
            <text class="progress-label" x="50" y="75">善匯</text>
            <circle class="progress-node locked" id="node1" cx="190" cy="30" r="10"/>
            <text class="progress-label" x="190" y="15">交通路線</text>
            <circle class="progress-node locked" id="node2" cx="350" cy="50" r="10"/>
            <text class="progress-label" x="350" y="75">餐廳</text>
            <circle class="progress-node locked" id="node3" cx="480" cy="30" r="10"/>
            <text class="progress-label" x="480" y="15">社區中心</text>
            <circle class="progress-node locked" id="node4" cx="580" cy="70" r="10"/>
            <text class="progress-label" x="580" y="95">公園</text>
            <circle class="progress-node locked" id="node5" cx="680" cy="40" r="10"/>
            <text class="progress-label" x="680" y="25">家興</text>
            <circle class="progress-node locked" id="node6" cx="750" cy="50" r="10"/>
            <text class="progress-label" x="750" y="75">街市</text>
        </svg>
    </div>
    
    <!-- 遊戲介紹 -->
    <div class="stage active" id="intro">
        <h2 class="stage-title">異空間----熟悉的陌生地</h2>
        <div class="notebook" id="notebook-intro">
            <div class="notebook-inner">
                <div class="notebook-front">
                    <div class="envelope-icon">✉️</div>
                </div>
                <div class="notebook-back">
                    <h3 class="notebook-title">迷途筆記</h3>
                    <p class="notebook-entry">我似乎被困在一個熟悉又陌生的空間，社區的輪廓依稀可見，但一切都籠罩著詭異的氛圍。最奇怪的是，我感覺不到任何情感，如同心是空洞的。</p>
                    <p class="notebook-entry">神秘聲音提到了<span class="notebook-highlight">心之鎖匙</span>，似乎只有找到它，我和其他居民才能恢復。我需要跟隨<span class="notebook-highlight">記憶碎片</span>開始這段奇異的旅程。</p>
                </div>
            </div>
        </div>
        <div class="dialogue-container show" id="intro-dialogue">
            <p class="dialogue-text typing-effect"><span class="dialogue-name">神秘聲音:</span>歡迎來到『心之迷途』。你，還有其他所有居民，都失去了自己的『心之鎖匙』。沒有它，你們的心將永遠是空洞的...</p>
        </div>
        <div class="story-section">
            <p>你醒來發現自己身處一個熟悉又陌生的空間，彷彿是你曾經生活的社區，卻又微妙地不同。周圍的一切都籠罩著一層詭異的氛圍，而更奇怪的是，你感覺自己的心是空洞的。</p>
        </div>
        <div class="void-heart" id="introHeart"></div>
        <div class="story-section objective">
            <p><strong>任務目標：</strong>探索這個詭異的空間，解開謎題，尋找失落的記憶碎片，找回你和居民的「心之鎖匙」。</p>
        </div>
        <div class="location-guide">
            <h3 class="location-title"><span class="location-icon">📍</span>當前位置</h3>
            <div class="location-path">
                <div class="location-step active">善匯</div>
            </div>
            <p class="location-clue">尋找心之鎖匙的旅程從這裡開始，你需要前往交通路線尋找第一個線索。</p>
        </div>
        <div class="map-container">
            <div class="location" style="top: 30%; left: 25%">
                <span class="location-label">巴士站</span>
            </div>
            <div class="location" style="top: 50%; left: 60%">
                <span class="location-label">地鐵站</span>
            </div>
            <div class="location" style="top: 70%; left: 40%">
                <span class="location-label">小巴站</span>
            </div>
            <div class="void-circle" style="top: 30%; left: 25%; width: 40px; height: 40px;"></div>
            <div class="hidden-clue">電話密碼藏在數字：999</div>
        </div>
        <div class="input-section">
            <button id="startBtn">前往交通路線</button>
        </div>
    </div>
    
    <!-- 第一關：交通路線 -->
    <div class="stage" id="stage1">
        <h2 class="stage-title">第一關：交通密碼</h2>
        <div class="story-section">
            <p>你來到社區的交通路線，周圍飄散著模糊的數字碎片。這些碎片似乎組成了某個特殊的密碼，可能與善匯職員有關。</p>
            <p>「呢組密碼係咩?」你自言自語地思考著。</p>
            <p>「這些數字似乎在巴士站有關，需要完成任務找到密碼？」</p>
        </div>
        <div class="dialogue-container show" id="stage1-dialogue">
            <p class="dialogue-text"><span class="dialogue-name">你:</span>這些飄散的數字...像是某種密碼，巴士站周圍的數字格外清晰。</p>
        </div>
        <div class="location-guide">
            <h3 class="location-title"><span class="location-icon">📍</span>當前位置</h3>
            <div class="location-path">
                <div class="location-step">善匯</div>
                <span class="location-arrow">→</span>
                <div class="location-step active">交通路線</div>
            </div>
            <p class="location-clue">數字密碼可能是某個電話號碼，尋找交通路線中隱藏的三位數字線索。</p>
        </div>
        <div class="story-section objective">
            <p><strong>目標：</strong>收集飄散的數字碎片，拼湊出一個三位數密碼。</p>
        </div>
        <div class="map-container">
            <div class="location" style="top: 30%; left: 25%">
                <span class="location-label">巴士站</span>
            </div>
            <div class="location" style="top: 50%; left: 60%">
                <span class="location-label">地鐵站</span>
            </div>
            <div class="location" style="top: 70%; left: 40%">
                <span class="location-label">小巴站</span>
            </div>
            <div class="void-circle" style="top: 30%; left: 25%; width: 40px; height: 40px;"></div>
            <div class="hidden-clue">電話密碼藏在數字：999</div>
        </div>
        <div class="input-section">
            <p class="hint">提示：尋找飄浮在巴士站周圍的數字</p>
            <input type="text" id="stage1Input" placeholder="輸入發現的數字...">
            <button id="stage1Btn">確認</button>
            <p class="error-message" id="stage1Error"></p>
        </div>
        <div class="key-effect" style="display: none;">
            <svg width="50" height="50" viewBox="0 0 50 50">
                <path d="M10 10 L20 20 M20 10 L10 20" stroke="#fbdc05" stroke-width="2"/>
            </svg>
        </div>
        <div class="hint-card" id="hint1">
            <p>集中注意力看巴士站周圍，那裡有三個相同的數字重複出現。這堆數字在空中重整，形成「密碼」，並請前往熟悉的餐廳!!</p>
        </div>
        <button class="hint-btn" id="showHint1">需要提示？</button>
    </div>
    
    <!-- 第二關：餐廳 -->
    <div class="stage" id="stage2">
        <h2 class="stage-title">第二關：神秘通訊</h2>
        <div class="story-section">
            <p>當你來到一家餐廳，請即刻完成任務。</p>
            <p>「唔通要打比電話中既人問佢係邊個?」你心想，這似乎是唯一的辦法了。</p>
        </div>
        <div class="dialogue-container show" id="stage2-dialogue">
            <p class="dialogue-text"><span class="dialogue-name">陌生人:</span>這部手機好像很重要...上面的號碼「999」，或許能連接到某人。</p>
        </div>
        <div class="location-guide">
            <h3 class="location-title"><span class="location-icon">📍</span>當前位置</h3>
            <div class="location-path">
                <div class="location-step">善匯</div>
                <span class="location-arrow">→</span>
                <div class="location-step">交通路線</div>
                <span class="location-arrow">→</span>
                <div class="location-step active">餐廳</div>
            </div>
            <p class="location-clue">你的下一站可能是社區中心，但需要先通過電話與昌溝通。</p>
        </div>
        <div class="story-section objective">
            <p><strong>目標：</strong>拆解電話密碼，致電他問下發生咩事</p>
        </div>
        <div class="phone">
            <div class="phone-screen" id="phoneScreen"></div>
            <div class="phone-button" id="phoneButton"></div>
        </div>
        <div class="story-section note">
            <p>餐廳中的陌生人給了你一部手機，你注意到已經有一個號碼「999」輸入在撥號介面上。現在你需要詢問接電話的人是誰。</p>
        </div>
        <div class="input-section">
            <p class="hint">提示：向接電話的人詢問他的身份</p>
            <input type="text" id="stage2Input" placeholder="輸入你要問的話...">
            <button id="stage2Btn">發送</button>
            <p class="error-message" id="stage2Error"></p>
        </div>
        <div class="key-effect" style="display: none;">
            <svg width="50" height="50" viewBox="0 0 50 50">
                <path d="M10 10 L20 20 M20 10 L10 20" stroke="#fbdc05" stroke-width="2"/>
            </svg>
        </div>
        <div class="hint-card" id="hint2">
            <p>嘗試最直接的問題，例如「你是誰」或「你係邊個」來確認對方的身份。</p>
        </div>
        <button class="hint-btn" id="showHint2">需要提示？</button>
    </div>
    
    <!-- 第三關：社區中心 -->
    <div class="stage" id="stage3">
        <h2 class="stage-title">第三關：社區活動</h2>
        <div class="story-section">
            <p>通過與昌的交流，你被引導到社區中心，這裡有許多活動和休憩空間。你需要找出社區中最特別的地方以繼續你的旅程。</p>
            <p>「除左到社區中心發現原來有好多活動，市民都會平時去的地方，唔通果度有咩特別?」你思考著。</p>
        </div>
        <div class="dialogue-container show" id="stage3-dialogue">
            <p class="dialogue-text"><span class="dialogue-name">昌:</span>社區中心有個特別的地方，那裡是許多居民心靈的休憩處。找到那裡，你會更接近答案。</p>
        </div>
        <div class="location-guide">
            <h3 class="location-title"><span class="location-icon">📍</span>當前位置</h3>
            <div class="location-path">
                <div class="location-step">善匯</div>
                <span class="location-arrow">→</span>
                <div class="location-step">交通路線</div>
                <span class="location-arrow">→</span>
                <div class="location-step">餐廳</div>
                <span class="location-arrow">→</span>
                <div class="location-step active">社區中心</div>
            </div>
            <p class="location-clue">探索社區中心的各個空間，特別是經常舉辦活動的地方。</p>
        </div>
        <div class="story-section objective">
            <p><strong>目標：</strong>找出社區中心中最重要的活動場所。</p>
        </div>
        <div class="community-map" id="communityMap">
            <svg width="100%" height="100%" viewBox="0 0 500 250">
                <rect x="0" y="0" width="500" height="250" fill="#1a1a2e"/>
                <path d="M50,125 L450,125 M250,50 L250,200" stroke="#303050" stroke-width="15" stroke-dasharray="10 5"/>
                <g class="community-building" id="activityRoom">
                    <rect x="80" y="30" width="80" height="60" fill="none" stroke="#505080" stroke-width="2" stroke-dasharray="5 3"/>
                    <text class="community-label" x="120" y="65">活動室</text>
                </g>
                <g class="community-building" id="infoCenter">
                    <rect x="210" y="100" width="80" height="60" fill="none" stroke="#505080" stroke-width="2" stroke-dasharray="5 3"/>
                    <text class="community-label" x="250" y="135">資訊處</text>
                </g>
                <g class="community-building pulse" id="restArea">
                    <rect x="340" y="170" width="80" height="60" fill="none" stroke="#9050a0" stroke-width="2"/>
                    <text class="community-label" x="380" y="205">公園</text>
                </g>
            </svg>
        </div>
        <div class="input-section">
            <p class="hint">提示：尋找社區中心裡特別顯眼或發光的區域</p>
            <input type="text" id="stage3Input" placeholder="輸入特殊的地點...">
            <button id="stage3Btn">確認</button>
            <p class="error-message" id="stage3Error"></p>
        </div>
        <div class="key-effect" style="display: none;">
            <svg width="50" height="50" viewBox="0 0 50 50">
                <path d="M10 10 L20 20 M20 10 L10 20" stroke="#fbdc05" stroke-width="2"/>
            </svg>
        </div>
        <div class="hint-card" id="hint3">
            <p>注意地圖上唯一有顏色邊框和脈衝效果的區域。「公園」是社區中最活躍的地方。</p>
        </div>
        <button class="hint-btn" id="showHint3">需要提示？</button>
    </div>
    
    <!-- 第四關：公園 -->
    <div class="stage" id="stage4">
        <h2 class="stage-title">第四關：神秘寶箱</h2>
        <div class="story-section">
            <p>公園的線索引導你來到公園，在草叢中發現了一個神秘的寶箱，裡面似乎藏著新的謎題和零食提示。</p>
            <p>「得到地圖前往好多零食與日用品的提醒紙，同一堆錢? 唔通要買D咩去收買人?」你驚訝地看著寶箱中的內容。</p>
        </div>
        <div class="dialogue-container show" id="stage4-dialogue">
            <p class="dialogue-text"><span class="dialogue-name">小孩:</span>那個寶箱很特別，只有知道密碼的人才能打開。人們說密碼是最基本的順序數字。</p>
        </div>
        <div class="location-guide">
            <h3 class="location-title"><span class="location-icon">📍</span>當前位置</h3>
            <div class="location-path">
                <div class="location-step">善匯</div>
                <span class="location-arrow">→</span>
                <div class="location-step">交通路線</div>
                <span class="location-arrow">→</span>
                <div class="location-step">餐廳</div>
                <span class="location-arrow">→</span>
                <div class="location-step">社區中心</div>
                <span class="location-arrow">→</span>
                <div class="location-step active">公園</div>
            </div>
            <p class="location-clue">寶箱中的錢和零食提示指向下一個目的地。</p>
        </div>
        <div class="story-section objective">
            <p><strong>目標：</strong>找出開啟寶箱的密碼，揭開箱中謎題。</p>
        </div>
        <div class="treasure-box" id="treasureBox"></div>
        <div class="money-collection">
            <div class="money-item">
                <span class="money-value">$10</span>
            </div>
            <div class="money-item">
                <span class="money-value">$20</span>
            </div>
            <div class="money-item">
                <span class="money-value">$50</span>
            </div>
            <div class="money-item">
                <span class="money-value">$100</span>
            </div>
        </div>
        <div class="story-section note">
            <p>寶箱表面閃爍著微弱的光芒，上面刻著「唯有正確的序列能開啟下一段旅程」。你感覺到寶箱在等待某組數字...</p>
        </div>
        <div class="input-section">
            <p class="hint">提示：寶箱需要一個簡單的數字序列開啟</p>
            <input type="password" id="stage4Input" placeholder="輸入密碼打開寶箱...">
            <button id="stage4Btn">開啟</button>
            <p class="error-message" id="stage4Error"></p>
        </div>
        <div class="key-effect" style="display: none;">
            <svg width="50" height="50" viewBox="0 0 50 50">
                <path d="M10 10 L20 20 M20 10 L10 20" stroke="#fbdc05" stroke-width="2"/>
            </svg>
        </div>
        <div class="hint-card" id="hint4">
            <p>提示紙上若隱若現的數字「1234」似乎是最基本的順序數字，可能是打開寶箱的密碼。</p>
        </div>
        <button class="hint-btn" id="showHint4">需要提示？</button>
    </div>
    
    <!-- 第五關：家興 -->
    <div class="stage" id="stage5">
        <h2 class="stage-title">第五關：食物紀念</h2>
        <div class="story-section">
            <p>寶箱中的線索引導你來到家興，這裡有各種食物的圖像和記憶。你需要找出這些食物代表的共同場所。</p>
            <p>「最後發現原來D錢唔係咁用，係用黎買一D食得既野，但發現「家」只剩最後一步」</p>
            <p>你開始理解，這些錢和食物圖像可能與某個重要的地方有關，而那個地方很可能是找回「家」的關鍵。</p>
        </div>
        <div class="dialogue-container show" id="stage5-dialogue">
            <p class="dialogue-text"><span class="dialogue-name">老婆婆:</span>我們每天都會去那個地方買新鮮的食材，那兒充滿了人情味和社區的連結。</p>
        </div>
        <div class="location-guide">
            <h3 class="location-title"><span class="location-icon">📍</span>當前位置</h3>
            <div class="location-path">
                <div class="location-step">善匯</div>
                <span class="location-arrow">→</span>
                <div class="location-step">交通路線</div>
                <span class="location-arrow">→</span>
                <div class="location-step">餐廳</div>
                <span class="location-arrow">→</span>
                <div class="location-step">社區中心</div>
                <span class="location-arrow">→</span>
                <div class="location-step">公園</div>
                <span class="location-arrow">→</span>
                <div class="location-step active">家興</div>
            </div>
            <p class="location-clue">這些食物回憶的共同來源是什麼地方？那裡可能是你的下一個目的地。</p>
        </div>
        <div class="story-section objective">
            <p><strong>目標：</strong>尋找這些食物記憶所代表的共同場所。</p>
        </div>
        <div class="inventory" id="foodInventory">
            <div class="food-item">
                <div class="food-img">🍜</div>
                <p>湯麵</p>
            </div>
            <div class="food-item">
                <div class="food-img">🍚</div>
                <p>米飯</p>
            </div>
            <div class="food-item">
                <div class="food-img">🥟</div>
                <p>餃子</p>
            </div>
            <div class="food-item">
                <div class="food-img">🍲</div>
                <p>火鍋</p>
            </div>
            <div class="food-item">
                <div class="food-img">🥬</div>
                <p>蔬菜</p>
            </div>
            <div class="food-item">
                <div class="food-img">🍪</div>
                <p>零食</p>
            </div>
        </div>
        <div class="story-section note">
            <p>當你觸碰這些食物圖像時，閃過一些模糊的記憶片段：人們買賣、交談、討價還價的場景，這些都發生在一個熱鬧的地方...</p>
        </div>
        <div class="input-section">
            <p class="hint">提示：這些食物共同代表著社區中的哪個地方？</p>
            <input type="text" id="stage5Input" placeholder="輸入這些食物的共同源頭...">
            <button id="stage5Btn">確認</button>
            <p class="error-message" id="stage5Error"></p>
        </div>
        <div class="key-effect" style="display: none;">
            <svg width="50" height="50" viewBox="0 0 50 50">
                <path d="M10 10 L20 20 M20 10 L10 20" stroke="#fbdc05" stroke-width="2"/>
            </svg>
        </div>
        <div class="hint-card" id="hint5">
            <p>這些都是新鮮的食材和料理，在社區中哪裡能找到最新鮮的食材？「街市」是購買食物的地方，充滿人情味和社區連結。</p>
        </div>
        <button class="hint-btn" id="showHint5">需要提示？</button>
    </div>
    
    <!-- 第六關：街市 -->
    <div class="stage" id="stage6">
        <h2 class="stage-title">第六關：回家路徑</h2>
        <div class="story-section">
            <p>你來到街市，這裡熱鬧非凡，充滿了食物和人情味。在這裡，所有的線索和記憶都交匯在一起，指向最終的目的地。</p>
            <p>「家與回憶，邊個地有似家的感覺，又有呢D食物回憶，就係善匯，然後回善匯」</p>
            <p>在街市中漫步，你感受到這裡與所有地方的連結，但同時也明白這只是旅程的一部分，真正的「家」還在別處。</p>
        </div>
        <div class="dialogue-container show" id="stage6-dialogue">
            <p class="dialogue-text"><span class="dialogue-name">商販:</span>善匯...那個地方是社區的心，連結著我們所有人。找到那個地方，你就能回家了。</p>
        </div>
        <div class="location-guide">
            <h3 class="location-title"><span class="location-icon">📍</span>當前位置</h3>
            <div class="location-path">
                <div class="location-step">善匯</div>
                <span class="location-arrow">→</span>
                <div class="location-step">交通路線</div>
                <span class="location-arrow">→</span>
                <div class="location-step">餐廳</div>
                <span class="location-arrow">→</span>
                <div class="location-step">社區中心</div>
                <span class="location-arrow">→</span>
                <div class="location-step">公園</div>
                <span class="location-arrow">→</span>
                <div class="location-step">家興</div>
                <span class="location-arrow">→</span>
                <div class="location-step active">街市</div>
            </div>
            <p class="location-clue">所有的回憶和情感都指向一個地方，那裡既是你旅程的起點，也是終點。</p>
        </div>
        <div class="story-section objective">
            <p><strong>目標：</strong>找出所有記憶的核心，真正的「家」在哪裡。</p>
        </div>
        <div class="map-container" id="finalMap">
            <div class="location" style="top: 20%; left: 20%">
                <span class="location-label">家興中心</span>
            </div>
            <div class="location" style="top: 40%; left: 50%">
                <span class="location-label">社區中心</span>
            </div>
            <div class="location" style="top: 60%; left: 70%">
                <span class="location-label">公園</span>
            </div>
            <div class="location" style="top: 70%; left: 30%">
                <span class="location-label">餐廳</span>
            </div>
            <div class="location" style="top: 40%; left: 80%">
                <span class="location-label">交通路線</span>
            </div>
            <div class="location pulse" style="top: 30%; left: 50%">
                <span class="location-label">善匯</span>
            </div>
        </div>
        <div class="story-section note">
            <p>當你在街市中流連，發現所有的商販、顧客都在談論著同一個地方，那是社區的心臟，所有人情味和連結的源頭，它的名字是...</p>
        </div>
        <div class="input-section">
            <p class="hint">提示：所有記憶的源頭，這個旅程的起點和終點</p>
            <input type="text" id="stage6Input" placeholder="輸入「家」的名稱...">
            <button id="stage6Btn">確認</button>
            <p class="error-message" id="stage6Error"></p>
        </div>
        <div class="key-effect" style="display: none;">
            <svg width="50" height="50" viewBox="0 0 50 50">
                <path d="M10 10 L20 20 M20 10 L10 20" stroke="#fbdc05" stroke-width="2"/>
            </svg>
        </div>
        <div class="hint-card" id="hint6">
            <p>回顧你的整個旅程，從哪裡開始，又將回到哪裡？地圖上唯一發光的地點提示著答案。「善匯」不僅是地名，也象徵著所有美好回憶和情感的匯聚之處。</p>
        </div>
        <button class="hint-btn" id="showHint6">需要提示？</button>
    </div>
    
    <!-- 結局 -->
    <div class="stage" id="ending">
        <h2 class="stage-title">心之回歸：尋回「家」的感覺</h2>
        <div class="story-section">
            <p>當你說出「善匯」的名字，所有記憶瞬間融合，強烈的光芒閃耀。你終於找到了心之鎖匙，也找到了真正的「家」。</p>
            <p>「恭喜你找到了心之鎖匙。現在你明白了，善匯不僅是一個地方，更是一種連結、一種情感、一種歸屬感。」</p>
            <p>「你不是孤單的旅行者，實際上，你一直都是善匯的一部分，而善匯的記憶也是你的一部分。」</p>
        </div>
        <div class="dialogue-container show" id="ending-dialogue">
            <p class="dialogue-text"><span class="dialogue-name">老婆婆:</span>我們一直在等你。謝謝你幫助我們找回遺失的心。善匯不只是一個地方，而是我們共同創造的心靈家園。</p>
        </div>
        <div class="void-heart filling" id="endingHeart"></div>
        <div class="location-guide">
            <h3 class="location-title"><span class="location-icon">🏠</span>回到起點</h3>
            <div class="location-path">
                <div class="location-step">善匯</div>
                <span class="location-arrow">→</span>
                <div class="location-step">交通路線</div>
                <span class="location-arrow">→</span>
                <div class="location-step">餐廳</div>
                <span class="location-arrow">→</span>
                <div class="location-step">社區中心</div>
                <span class="location-arrow">→</span>
                <div class="location-step">公園</div>
                <span class="location-arrow">→</span>
                <div class="location-step">家興</div>
                <span class="location-arrow">→</span>
                <div class="location-step">街市</div>
                <span class="location-arrow">→</span>
                <div class="location-step active">善匯</div>
            </div>
            <p class="location-clue">旅程結束了，但「家」的故事才剛剛開始。</p>
        </div>
        <div class="story-section">
            <p>光芒漸漸消散，迷霧散去。你發現自己站在熟悉的善匯社區中心，周圍是熟悉的面孔，但這次，每個人的眼中都充滿了生命力和情感。</p>
            <p>你環顧四周，理解了一切。這不是一個迷途的異空間，而是你們共同創造的家園。而「心之鎖匙」，正是彼此間的連結和關懷。</p>
        </div>
        <div class="achievements">
            <div class="achievement unlocked" id="achievement1End">
                🔍
                <span class="achievement-label">迷境探索者</span>
            </div>
            <div class="achievement unlocked" id="achievement2End">
                💬
                <span class="achievement-label">虛實連結者</span>
            </div>
            <div class="achievement unlocked" id="achievement3End">
                🧩
                <span class="achievement-label">謎題解鎖者</span>
            </div>
            <div class="achievement unlocked" id="achievement4End">
                🤝
                <span class="achievement-label">心靈修復師</span>
            </div>
            <div class="achievement unlocked" id="achievement5End">
                🏆
                <span class="achievement-label">善匯守護者</span>
            </div>
        </div>
        <div class="effect-container" id="endingEffect"></div>
        <div class="notebook" id="notebook-ending">
            <div class="notebook-inner">
                <div class="notebook-front">
                    <div class="envelope-icon">✉️</div>
                </div>
                <div class="notebook-back">
                    <h3 class="notebook-title">迷途筆記 - 終章</h3>
                    <p class="notebook-entry">旅程結束了，但我感到前所未有的完整。找回心之鎖匙並不是找到某個物品，而是重新連接與社區、與他人的情感紐帶。</p>
                    <p class="notebook-entry"><span class="notebook-highlight">善匯</span>不只是一個地方，而是所有人共同創造的<span class="notebook-highlight">心靈家園</span>。正如它的名字所暗示：善良匯聚之處，就是我真正的家。</p>
                </div>
            </div>
        </div>
        <div class="input-section">
            <button id="restartBtn">重新開始旅程</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        let currentStage = 0;
        const totalStages = 6;
        const stages = ['intro', 'stage1', 'stage2', 'stage3', 'stage4', 'stage5', 'stage6', 'ending'];
        
        const answers = {
            stage1: '999',
            stage2: '昌',
            stage3: '公園',
            stage4: '1234',
            stage5: '街市',
            stage6: '善匯'
        };
        
        const alternativeAnswers = {
            stage2: ['你是誰', '你係邊個', '你叫咩名', '你係咩人', '身份', '你是誰？', '昌'],
            stage3: ['心靈休憩處', '休憩處', '心靈休息處', '公園'],
            stage5: ['街市', '市場', '傳統市場', '菜市場'],
            stage6: ['善匯', '善匯社區', '善匯中心']
        };
        
        const cutscenes = {
            intro: { title: "心之迷途", text: "你醒來於一個熟悉又陌生的空間，這裡像是社區的倒影，卻籠罩著詭異的氛圍。更奇怪的是，你感覺不到任何情感，如同心是空洞的。" },
            stage1: { title: "交通密碼", text: "你來到社區的交通路線，周圍飄散著模糊的數字碎片。這些數字似乎試圖訴說著什麼，它們聚集在巴士站附近，等待著被解讀。" },
            stage2: { title: "神秘通訊", text: "餐廳裡的陌生人遞給你一部手機，上面已有一組號碼。這組號碼或許能連結到重要的人，幫助你理解這個空間的謎題。" },
            stage3: { title: "社區活動", text: "社區中心充滿了活動和回憶的痕跡，這裡的每個空間都蘊含著居民的情感與連結。其中一個特別的地方或許能引導你前往下一個目的地。" },
            stage4: { title: "神秘寶箱", text: "公園的草叢中藏著一個奇特的寶箱，閃爍著微弱的光芒。它似乎在等待某組密碼，打開它可能會揭示更多關於這個世界的秘密。" },
            stage5: { title: "食物紀念", text: "各種食物的記憶在家興交織，每一種食物都連結著社區的某個角落。這些食物來自哪裡？那個地方或許是你尋找「家」的關鍵。" },
            stage6: { title: "回家路徑", text: "在熱鬧的街市中，所有的線索與記憶匯聚一處。你的旅程已近終點，真正的「家」就在眼前，就是所有回憶的起點。" },
            ending: { title: "心之回歸", text: "當你說出「善匯」的名字，所有記憶瞬間融合，強烈的光芒閃耀。你終於找到了心之鎖匙，也找到了真正的「家」。" }
        };
        
        const envelopeContent = {
            intro: { title: "心之迷途", content: "你醒來於一個熟悉又陌生的空間，如同社區的倒影，卻籠罩著詭異的氛圍。你感覺不到任何情感，心是空洞的。找回心之鎖匙，才能恢復自我。" },
            stage1: { title: "交通密碼", content: "數字在空氣中飄浮，試圖引導你找到關鍵。注意巴士站附近的特殊數字，它們將連接你與下一個目的地。" },
            stage2: { title: "神秘通訊", content: "這部手機連接著一個重要的人物，他能為你解答更多謎團。撥通號碼，詢問他的身份，尋找前往社區中心的道路。" },
            stage3: { title: "社區活動", content: "社區中心有個特別的場所，那裡承載著居民的心靈休憩。找到那個地方，你將更接近心之鎖匙。" },
            stage4: { title: "神秘寶箱", content: "公園中的寶箱蘊藏著下一步的提示。正確的數字序列將開啟它，揭示購買食物的意義。" },
            stage5: { title: "食物紀念", content: "這些食物來自同一個地方，那裡充滿人情味和社區的連結。找出這個地方，你將更接近「家」的真正含義。" },
            stage6: { title: "回家路徑", content: "所有線索指向一個地方，它既是你旅程的起點，也是終點。這個地方的名字，代表著社區心靈的聚集地。" },
            ending: { title: "心之回歸", content: "恭喜你找到了心之鎖匙！善匯不僅是一個地方，更是一種連結、一種情感、一種歸屬感。你已重新連接與社區、與他人的情感紐帶。" }
        };
        
        const notebooks = document.querySelectorAll('.notebook');
        notebooks.forEach(notebook => {
            notebook.addEventListener('click', function() {
                this.classList.toggle('flipped');
            });
        });
        
        function updateProgress() {
            const progressBar = document.getElementById('progressBar');
            const progressPercentage = (currentStage / totalStages) * 100;
            progressBar.style.width = `${progressPercentage}%`;
            for (let i = 0; i <= totalStages; i++) {
                const node = document.getElementById(`node${i}`);
                if (node) {
                    if (i < currentStage) {
                        node.classList.remove('current', 'locked');
                        node.classList.add('completed');
                    } else if (i === currentStage) {
                        node.classList.remove('completed', 'locked');
                        node.classList.add('current');
                    } else {
                        node.classList.remove('completed', 'current');
                        node.classList.add('locked');
                    }
                }
            }
        }
        
        function showEnvelope(stage) {
            const envelope = document.getElementById('envelope-container');
            const letterTitle = document.getElementById('letter-title');
            const letterContent = document.getElementById('letter-content');
            letterTitle.textContent = envelopeContent[stages[stage]].title;
            letterContent.textContent = envelopeContent[stages[stage]].content;
            envelope.classList.add('active');
            setTimeout(() => {
                envelope.classList.add('opening');
                setTimeout(() => {
                    envelope.classList.remove('opening');
                    setTimeout(() => {
                        envelope.classList.remove('active');
                        setTimeout(() => {
                            showCutscene(stage);
                        }, 500);
                    }, 2000);
                }, 5000);
            }, 1000);
            envelope.addEventListener('click', function closeHandler() {
                envelope.classList.remove('opening');
                setTimeout(() => {
                    envelope.classList.remove('active');
                }, 500);
                envelope.removeEventListener('click', closeHandler);
                setTimeout(() => {
                    showCutscene(stage);
                }, 500);
            });
        }
        
        function showCutscene(stage) {
            const cutscene = document.getElementById('cutscene');
            const cutsceneTitle = document.getElementById('cutscene-title');
            const cutsceneText = document.getElementById('cutscene-text');
            cutsceneTitle.textContent = cutscenes[stages[stage]].title;
            cutsceneText.textContent = cutscenes[stages[stage]].text;
            cutscene.classList.add('active');
            cutscene.addEventListener('click', function closeHandler() {
                cutscene.classList.remove('active');
                cutscene.removeEventListener('click', closeHandler);
            });
            setTimeout(() => {
                cutscene.classList.remove('active');
            }, 6000);
        }
        
        function switchStage(fromStage, toStage) {
            document.getElementById(stages[fromStage]).classList.remove('active');
            document.getElementById(stages[toStage]).classList.add('active');
            currentStage = toStage;
            updateProgress();
            notebooks.forEach(notebook => {
                notebook.classList.remove('flipped');
            });
            document.getElementById(stages[toStage]).style.animation = 'none';
            setTimeout(() => {
                document.getElementById(stages[toStage]).style.animation = 'fadeIn 1s ease';
            }, 10);
            showEnvelope(toStage);
            if (toStage === 2) initPhoneChat();
            else if (toStage === 4) initTreasureBox();
            else if (toStage === 7) createEndingEffect();
            createSceneTransitionEffect();
        }
        
        function createSceneTransitionEffect() {
            const gameContainer = document.querySelector('.game-container');
            const effectContainer = document.createElement('div');
            effectContainer.className = 'effect-container';
            gameContainer.appendChild(effectContainer);
            for (let i = 0; i < 30; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = `${Math.random() * 100}%`;
                sparkle.style.top = `${Math.random() * 100}%`;
                sparkle.style.opacity = '0';
                effectContainer.appendChild(sparkle);
                setTimeout(() => {
                    sparkle.style.transition = 'all 0.8s ease';
                    sparkle.style.opacity = '1';
                    setTimeout(() => {
                        sparkle.style.opacity = '0';
                    }, 600);
                }, Math.random() * 300);
            }
            setTimeout(() => {
                effectContainer.remove();
            }, 1500);
        }
        
        function createEffect(element, type) {
            const effectContainer = document.createElement('div');
            effectContainer.className = 'effect-container';
            element.appendChild(effectContainer);
            if (type === 'confetti') {
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.top = `${Math.random() * 100}%`;
                    confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                    confetti.style.width = `${5 + Math.random() * 10}px`;
                    confetti.style.height = `${5 + Math.random() * 10}px`;
                    confetti.style.opacity = '1';
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    effectContainer.appendChild(confetti);
                    setTimeout(() => {
                        confetti.style.transition = 'all 2s ease';
                        confetti.style.top = '100%';
                        confetti.style.opacity = '0';
                    }, Math.random() * 500);
                }
                setTimeout(() => {
                    effectContainer.remove();
                }, 3000);
            } else if (type === 'sparkle') {
                for (let i = 0; i < 30; i++) {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.style.left = `${Math.random() * 100}%`;
                    sparkle.style.top = `${Math.random() * 100}%`;
                    sparkle.style.opacity = '1';
                    effectContainer.appendChild(sparkle);
                    setTimeout(() => {
                        sparkle.style.transition = 'all 1s ease';
                        sparkle.style.transform = `translate(${(Math.random() - 0.5) * 100}px, ${(Math.random() - 0.5) * 100}px)`;
                        sparkle.style.opacity = '0';
                    }, Math.random() * 300);
                }
                setTimeout(() => {
                    effectContainer.remove();
                }, 2000);
            }
        }
        
        function initPhoneChat() {
            const phoneScreen = document.getElementById('phoneScreen');
            phoneScreen.innerHTML = '';
            const initialMessage = document.createElement('div');
            initialMessage.className = 'message incoming';
            initialMessage.textContent = '你好，這裡是昌。我不太明白你在說什麼...你需要什麼幫助嗎？';
            phoneScreen.appendChild(initialMessage);
        }
        
        function initTreasureBox() {
            const treasureBox = document.getElementById('treasureBox');
            treasureBox.classList.remove('open');
            treasureBox.addEventListener('click', function() {
                const input = document.getElementById('stage4Input').value;
                if (input === answers.stage4) {
                    treasureBox.classList.add('open');
                    createEffect(treasureBox, 'sparkle');
                    setTimeout(() => {
                        document.getElementById('stage4Btn').click();
                    }, 2000);
                } else {
                    treasureBox.classList.add('shake');
                    setTimeout(() => {
                        treasureBox.classList.remove('shake');
                    }, 500);
                    document.getElementById('stage4Error').textContent = '密碼錯誤，寶箱拒絕打開';
                }
            });
        }
        
        function createEndingEffect() {
            const endingEffect = document.getElementById('endingEffect');
            createEffect(endingEffect.parentElement, 'confetti');
            const title = document.querySelector('#ending .stage-title');
            title.classList.add('glow');
            setTimeout(() => {
                createEffect(endingEffect.parentElement, 'sparkle');
            }, 2000);
            setTimeout(() => {
                createEffect(endingEffect.parentElement, 'confetti');
            }, 4000);
        }
        
        function checkAnswer(stage, input) {
            input = input.trim().toLowerCase();
            if (input === answers[stage].toLowerCase()) return true;
            if (alternativeAnswers[stage]) {
                for (let i = 0; i < alternativeAnswers[stage].length; i++) {
                    if (input === alternativeAnswers[stage][i].toLowerCase() || 
                        input.includes(alternativeAnswers[stage][i].toLowerCase())) {
                        return true;
                    }
                }
            }
            return false;
        }
        
        document.getElementById('showHint1').addEventListener('click', function() {
            document.getElementById('hint1').classList.toggle('show');
            this.textContent = document.getElementById('hint1').classList.contains('show') ? '隱藏提示' : '需要提示？';
        });
        document.getElementById('showHint2').addEventListener('click', function() {
            document.getElementById('hint2').classList.toggle('show');
            this.textContent = document.getElementById('hint2').classList.contains('show') ? '隱藏提示' : '需要提示？';
        });
        document.getElementById('showHint3').addEventListener('click', function() {
            document.getElementById('hint3').classList.toggle('show');
            this.textContent = document.getElementById('hint3').classList.contains('show') ? '隱藏提示' : '需要提示？';
        });
        document.getElementById('showHint4').addEventListener('click', function() {
            document.getElementById('hint4').classList.toggle('show');
            this.textContent = document.getElementById('hint4').classList.contains('show') ? '隱藏提示' : '需要提示？';
        });
        document.getElementById('showHint5').addEventListener('click', function() {
            document.getElementById('hint5').classList.toggle('show');
            this.textContent = document.getElementById('hint5').classList.contains('show') ? '隱藏提示' : '需要提示？';
        });
        document.getElementById('showHint6').addEventListener('click', function() {
            document.getElementById('hint6').classList.toggle('show');
            this.textContent = document.getElementById('hint6').classList.contains('show') ? '隱藏提示' : '需要提示？';
        });
        
        document.getElementById('gameStartBtn').addEventListener('click', function() {
            document.querySelector('.start-screen').style.display = 'none';
            document.querySelector('.game-container').style.display = 'block';
            updateProgress();
            setTimeout(() => {
                showEnvelope(0);
            }, 500);
        });
        
        document.getElementById('startBtn').addEventListener('click', function() {
            switchStage(0, 1);
        });
        
        document.getElementById('stage1Btn').addEventListener('click', function() {
            const input = document.getElementById('stage1Input').value.trim();
            const errorMsg = document.getElementById('stage1Error');
            const keyEffect = document.querySelector('#stage1 .key-effect');
            if (input === answers.stage1) {
                errorMsg.textContent = '';
                createEffect(this.parentElement, 'sparkle');
                keyEffect.style.display = 'block';
                setTimeout(() => {
                    keyEffect.classList.add('show');
                }, 10);
                this.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 300);
                setTimeout(() => {
                    switchStage(1, 2);
                    keyEffect.classList.remove('show');
                    setTimeout(() => {
                        keyEffect.style.display = 'none';
                    }, 500);
                }, 2000);
            } else {
                errorMsg.textContent = '這不是正確的數字序列，繼續尋找交通路線中的密碼';
                this.classList.add('shake');
                setTimeout(() => {
                    this.classList.remove('shake');
                }, 500);
            }
        });
        
        document.getElementById('stage2Btn').addEventListener('click', function() {
            const input = document.getElementById('stage2Input').value.trim().toLowerCase();
            const errorMsg = document.getElementById('stage2Error');
            const phoneScreen = document.getElementById('phoneScreen');
            const keyEffect = document.querySelector('#stage2 .key-effect');
            const userMessage = document.createElement('div');
            userMessage.className = 'message outgoing';
            userMessage.textContent = document.getElementById('stage2Input').value;
            phoneScreen.appendChild(userMessage);
            phoneScreen.scrollTop = phoneScreen.scrollHeight;
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'message incoming';
            typingIndicator.innerHTML = '<span style="opacity: 0.7">...</span>';
            phoneScreen.appendChild(typingIndicator);
            setTimeout(() => {
                phoneScreen.removeChild(typingIndicator);
                if (checkAnswer('stage2', input)) {
                    errorMsg.textContent = '';
                    const replyMessage = document.createElement('div');
                    replyMessage.className = 'message incoming';
                    replyMessage.textContent = '我是善匯的社工昌。很高興能協助你。你現在應該前往社區中心，那裡有許多活動和休憩處，可能會找到更多線索。';
                    phoneScreen.appendChild(replyMessage);
                    phoneScreen.scrollTop = phoneScreen.scrollHeight;
                    keyEffect.style.display = 'block';
                    setTimeout(() => {
                        keyEffect.classList.add('show');
                    }, 10);
                    this.style.transform = 'scale(1.1)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 300);
                    setTimeout(() => {
                        switchStage(2, 3);
                        keyEffect.classList.remove('show');
                        setTimeout(() => {
                            keyEffect.style.display = 'none';
                        }, 500);
                    }, 3000);
                } else {
                    const replyMessage = document.createElement('div');
                    replyMessage.className = 'message incoming';
                    replyMessage.textContent = '我不太明白你在說什麼...你需要知道我是誰嗎？我是昌，善匯的社工。';
                    phoneScreen.appendChild(replyMessage);
                    phoneScreen.scrollTop = phoneScreen.scrollHeight;
                    errorMsg.textContent = '嘗試直接詢問對方的身份';
                }
            }, 1200);
            document.getElementById('stage2Input').value = '';
        });
        
        document.getElementById('stage3Btn').addEventListener('click', function() {
            const input = document.getElementById('stage3Input').value.trim().toLowerCase();
            const errorMsg = document.getElementById('stage3Error');
            const keyEffect = document.querySelector('#stage3 .key-effect');
            if (checkAnswer('stage3', input)) {
                errorMsg.textContent = '';
                createEffect(this.parentElement, 'sparkle');
                keyEffect.style.display = 'block';
                setTimeout(() => {
                    keyEffect.classList.add('show');
                }, 10);
                this.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 300);
                setTimeout(() => {
                    switchStage(3, 4);
                    keyEffect.classList.remove('show');
                    setTimeout(() => {
                        keyEffect.style.display = 'none';
                    }, 500);
                }, 2000);
            } else {
                errorMsg.textContent = '這個地方似乎不是社區活動的主要場所，繼續尋找';
                this.classList.add('shake');
                setTimeout(() => {
                    this.classList.remove('shake');
                }, 500);
            }
        });
        
        document.getElementById('stage4Btn').addEventListener('click', function() {
            const input = document.getElementById('stage4Input').value;
            const errorMsg = document.getElementById('stage4Error');
            const treasureBox = document.getElementById('treasureBox');
            const keyEffect = document.querySelector('#stage4 .key-effect');
            if (input === answers.stage4) {
                errorMsg.textContent = '';
                if (!treasureBox.classList.contains('open')) {
                    treasureBox.classList.add('open');
                    createEffect(treasureBox, 'sparkle');
                }
                keyEffect.style.display = 'block';
                setTimeout(() => {
                    keyEffect.classList.add('show');
                }, 10);
                this.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 300);
                setTimeout(() => {
                    switchStage(4, 5);
                    keyEffect.classList.remove('show');
                    setTimeout(() => {
                        keyEffect.style.display = 'none';
                    }, 500);
                }, 2000);
            } else {
                errorMsg.textContent = '密碼錯誤，寶箱拒絕打開';
                this.classList.add('shake');
                setTimeout(() => {
                    this.classList.remove('shake');
                }, 500);
            }
        });
        
        document.getElementById('stage5Btn').addEventListener('click', function() {
            const input = document.getElementById('stage5Input').value.trim().toLowerCase();
            const errorMsg = document.getElementById('stage5Error');
            const keyEffect = document.querySelector('#stage5 .key-effect');
            if (checkAnswer('stage5', input)) {
                errorMsg.textContent = '';
                createEffect(this.parentElement, 'sparkle');
                keyEffect.style.display = 'block';
                setTimeout(() => {
                    keyEffect.classList.add('show');
                }, 10);
                this.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 300);
                setTimeout(() => {
                    switchStage(5, 6);
                    keyEffect.classList.remove('show');
                    setTimeout(() => {
                        keyEffect.style.display = 'none';
                    }, 500);
                }, 2000);
            } else {
                errorMsg.textContent = '這不是這些食物的共同來源，再思考購買新鮮食材的地方';
                this.classList.add('shake');
                setTimeout(() => {
                    this.classList.remove('shake');
                }, 500);
            }
        });
        
        document.getElementById('stage6Btn').addEventListener('click', function() {
            const input = document.getElementById('stage6Input').value.trim().toLowerCase();
            const errorMsg = document.getElementById('stage6Error');
            const keyEffect = document.querySelector('#stage6 .key-effect');
            if (checkAnswer('stage6', input)) {
                errorMsg.textContent = '';
                createEffect(this.parentElement, 'confetti');
                keyEffect.style.display = 'block';
                setTimeout(() => {
                    keyEffect.classList.add('show');
                }, 10);
                this.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 300);
                setTimeout(() => {
                    switchStage(6, 7);
                    keyEffect.classList.remove('show');
                    setTimeout(() => {
                        keyEffect.style.display = 'none';
                    }, 500);
                }, 2000);
            } else {
                errorMsg.textContent = '這不是你旅程的起點和終點，思考整個旅程開始的地方';
                this.classList.add('shake');
                setTimeout(() => {
                    this.classList.remove('shake');
                }, 500);
            }
        });
        
        document.getElementById('restartBtn').addEventListener('click', function() {
            location.reload();
        });
        
        document.querySelectorAll('.food-item').forEach(item => {
            item.addEventListener('click', function() {
                createEffect(this, 'sparkle');
                this.style.backgroundColor = 'rgba(74, 20, 140, 0.3)';
                setTimeout(() => {
                    const allSelected = Array.from(document.querySelectorAll('.food-item'))
                        .every(el => el.style.backgroundColor === 'rgba(74, 20, 140, 0.3)');
                    if (allSelected) {
                        document.getElementById('stage5Input').value = '街市';
                        document.getElementById('stage5Btn').click();
                    }
                }, 500);
            });
        });
        
        document.getElementById('activityRoom').addEventListener('click', function() {
            document.getElementById('stage3Input').value = '活動室';
            createEffect(this, 'sparkle');
        });
        document.getElementById('infoCenter').addEventListener('click', function() {
            document.getElementById('stage3Input').value = '資訊處';
            createEffect(this, 'sparkle');
        });
        document.getElementById('restArea').addEventListener('click', function() {
            document.getElementById('stage3Input').value = '公園';
            createEffect(this, 'sparkle');
            setTimeout(() => {
                document.getElementById('stage3Btn').click();
            }, 500);
        });
        
        document.querySelectorAll('#finalMap .location').forEach(location => {
            location.addEventListener('click', function() {
                const locationName = this.querySelector('.location-label').textContent;
                document.getElementById('stage6Input').value = locationName;
                createEffect(this, 'sparkle');
                if (locationName === '善匯') {
                    setTimeout(() => {
                        document.getElementById('stage6Btn').click();
                    }, 500);
                }
            });
        });
        
        document.getElementById('phoneButton').addEventListener('click', function() {
            this.style.backgroundColor = '#555';
            setTimeout(() => {
                this.style.backgroundColor = '#333';
            }, 200);
        });
    });
</script>

</body>
</html>

